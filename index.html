<!doctype html>
<html lang="zh">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Spatial Desktop | Fix Background</title>

<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;900&family=Lexend+Deca:wght@400;600&display=swap" rel="stylesheet">

<style>
:root {
  --glass-bg: rgba(255, 255, 255, 0.12);
  --glass-border: rgba(255, 255, 255, 0.4);
  --pill-active: rgba(255, 255, 255, 0.3);
  --text-pure: #FFFFFF;
}

* { box-sizing: border-box; margin: 0; padding: 0; cursor: default; }

body {
  height: 100vh; width: 100vw;
  display: flex; flex-direction: column; align-items: center;
  justify-content: flex-start;
  padding-top: 12vh;
  background-color: #1a1a1a; /* 稍微亮一点的底色，防止纯黑死板 */
  font-family: 'Lexend Deca', sans-serif;
  overflow: hidden; perspective: 2000px;
  -webkit-font-smoothing: antialiased;
}

#bg-container {
  position: absolute; top: -10%; left: -10%; width: 120%; height: 120%;
  z-index: -1; transform: scale(1.1) translate3d(0, 0, 0);
  /* 设置默认背景图，防止 JS 失效时黑屏 */
  background: url('https://api.dujin.org/bing/1920.php') no-repeat center center/cover;
  filter: brightness(1.05) contrast(1.15) saturate(1.1);
  transition: transform 1.2s cubic-bezier(0.1, 0.9, 0.2, 1), opacity 0.5s ease;
  backface-visibility: hidden;
  opacity: 1;
}

.time-area { margin-bottom: 60px; text-align: center; pointer-events: none; z-index: 2; }

#clock {
  font-family: 'Montserrat', sans-serif; font-size: 110px; font-weight: 500;
  line-height: 1; letter-spacing: 25px; color: var(--text-pure);
  filter: drop-shadow(0 0 25px rgba(0,0,0,0.5));
}

#date-info {
  display: flex; justify-content: center; align-items: center;
  gap: 25px; font-size: 14px; font-weight: 600; letter-spacing: 10px;
  margin-top: 15px; color: var(--text-pure); text-transform: uppercase;
}

.card {
  position: relative; width: 92%; max-width: 660px; padding: 50px;
  background: var(--glass-bg);
  backdrop-filter: blur(35px) saturate(300%) contrast(1.1);
  -webkit-backdrop-filter: blur(35px) saturate(300%) contrast(1.1);
  border-radius: 45px; border: 1px solid var(--glass-border);
  box-shadow: 0 40px 120px rgba(0,0,0,0.7);
  transform: translate3d(0, 0, 0); transform-style: preserve-3d;
  transition: transform 0.8s cubic-bezier(0.15, 0.88, 0.3, 1);
  overflow: hidden; z-index: 5;
}

.card-glow {
  position: absolute; inset: 0;
  background: radial-gradient(500px circle at var(--x) var(--y), rgba(255,255,255,0.3), transparent 60%);
  pointer-events: none; z-index: 1;
}

#search-form { position: relative; z-index: 10; }

input {
  width: 100%; padding: 22px 35px; border-radius: 22px; border: none;
  background: rgba(255, 255, 255, 0.15); color: #fff; font-size: 22px; outline: none;
  border: 1px solid rgba(255, 255, 255, 0.2); transition: all 0.4s ease;
}

.engine-tabs {
  display: flex; position: relative; justify-content: space-between;
  margin-top: 40px; padding: 6px; background: rgba(0, 0, 0, 0.4); border-radius: 20px;
}

.nav-pill {
  position: absolute; top: 6px; left: 6px; height: calc(100% - 12px);
  background: var(--pill-active); border-radius: 14px;
  transition: all 0.5s cubic-bezier(0.23, 1, 0.32, 1); z-index: 0;
  pointer-events: none;
}

.engine-btn {
  background: transparent; border: none; color: #fff; opacity: 0.7;
  padding: 12px 0; cursor: pointer; font-size: 11px; font-weight: 600;
  letter-spacing: 2px; flex: 1; position: relative; z-index: 1;
  outline: none;
}

.engine-btn.active { opacity: 1; font-weight: 700; }

.footer { position: fixed; bottom: 30px; font-size: 10px; letter-spacing: 12px; opacity: 0.7; color: #fff; }
</style>
</head>

<body>

<div id="bg-container"></div>

<div class="time-area">
  <div id="clock">00:00</div>
  <div id="date-info">
    <span id="date-text">JANUARY 01</span>
    <span id="day-text">MONDAY</span>
  </div>
</div>

<div class="card" id="parallax-card">
  <div class="card-glow" id="card-glow"></div>
  <form id="search-form">
    <input id="search-input" autofocus autocomplete="off" placeholder="">
    <div class="engine-tabs" id="engine-bar">
      <div class="nav-pill" id="nav-pill"></div>
      <button type="button" class="engine-btn" data-engine="gg">GOOGLE</button>
      <button type="button" class="engine-btn" data-engine="bi">BING</button>
      <button type="button" class="engine-btn" data-engine="bd">BAIDU</button>
      <button type="button" class="engine-btn" data-engine="dg">DUCKGO</button>
      <button type="button" class="engine-btn" data-engine="gh">GITHUB</button>
    </div>
  </form>
</div>

<script>
(function(){
  const card = document.getElementById("parallax-card");
  const bg = document.getElementById("bg-container");
  const pill = document.getElementById("nav-pill");
  const buttons = document.querySelectorAll(".engine-btn");
  const input = document.getElementById("search-input");

  // 1. 强化背景更新逻辑：预加载确保不黑屏
  function updateWallpaper() {
    const today = new Date().toISOString().slice(0, 10);
    const imgUrl = `https://api.dujin.org/bing/1920.php?d=${today}`;
    
    // 创建一个虚拟图片对象预加载
    const img = new Image();
    img.src = imgUrl;
    img.onload = () => {
      bg.style.backgroundImage = `url('${imgUrl}')`;
    };
  }
  updateWallpaper();

  const engines = { 
    gg: "https://www.google.com/search?q=", 
    bi: "https://www.bing.com/search?q=", 
    bd: "https://www.baidu.com/s?wd=", 
    dg: "https://duckduckgo.com/?q=", 
    gh: "https://github.com/search?q=" 
  };
  
  let currentEngine = localStorage.getItem("preferredEngine") || "gg";

  const updatePillPosition = (activeBtn) => {
    if (!activeBtn) return;
    const rect = activeBtn.getBoundingClientRect();
    const parentRect = activeBtn.parentElement.getBoundingClientRect();
    pill.style.width = rect.width + "px";
    pill.style.transform = `translateX(${rect.left - parentRect.left - 6}px)`;
  };

  const setActiveEngine = (id) => {
    const activeBtn = Array.from(buttons).find(btn => btn.dataset.engine === id);
    if (activeBtn) {
      buttons.forEach(btn => btn.classList.remove("active"));
      activeBtn.classList.add("active");
      currentEngine = id; 
      localStorage.setItem("preferredEngine", id);
      requestAnimationFrame(() => {
        requestAnimationFrame(() => updatePillPosition(activeBtn));
      });
    }
  };

  document.addEventListener("mousemove", (e) => {
    const x = (window.innerWidth / 2 - e.pageX) / 160;
    const y = (window.innerHeight / 2 - e.pageY) / 160;
    bg.style.transform = `scale(1.1) translate3d(${x * -0.8}px, ${y * -0.8}px, 0)`;
    card.style.transform = `translate3d(${x}px, ${y}px, 0) rotateX(${-y * 0.4}deg) rotateY(${x * 0.4}deg)`;
    const rect = card.getBoundingClientRect();
    card.style.setProperty("--x", `${e.clientX - rect.left}px`);
    card.style.setProperty("--y", `${e.clientY - rect.top}px`);
  });

  buttons.forEach(btn => {
    btn.addEventListener('click', () => setActiveEngine(btn.dataset.engine));
    btn.addEventListener('focus', () => setActiveEngine(btn.dataset.engine));
  });

  document.getElementById("search-form").onsubmit = e => { 
    e.preventDefault(); 
    const val = input.value.trim();
    if (val) window.location.href = engines[currentEngine] + encodeURIComponent(val);
  };

  window.addEventListener('load', () => {
    setActiveEngine(currentEngine);
    setTimeout(() => {
      updatePillPosition(document.querySelector(".engine-btn.active"));
    }, 200);
  });

  window.addEventListener('resize', () => {
    updatePillPosition(document.querySelector(".engine-btn.active"));
  });

  function updateTime() {
    const now = new Date();
    document.getElementById("clock").textContent = String(now.getHours()).padStart(2, '0') + ":" + String(now.getMinutes()).padStart(2, '0');
    document.getElementById("date-text").textContent = now.toLocaleDateString('en-US', { month: 'long', day: 'numeric' }).toUpperCase();
    document.getElementById("day-text").textContent = now.toLocaleDateString('en-US', { weekday: 'long' }).toUpperCase();
  }
  setInterval(updateTime, 1000); updateTime();
})();
</script>
</body>
</html>
